(window.webpackJsonp=window.webpackJsonp||[]).push([[164],{495:function(t,a,e){"use strict";e.r(a);var n=e(42),s=Object(n.a)({},(function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"自定义命令"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#自定义命令"}},[t._v("#")]),t._v(" 自定义命令")]),t._v(" "),e("p",[t._v("命令代表单个操作，控制这场景中的发生事件。比如，可以用于改变背景，移动角色，或是加载其他脚本。"),e("RouterLink",{attrs:{to:"/zh/guide/naninovel-scripts.html"}},[t._v("naninovel 脚本")]),t._v(" 定义的参数化命令序列可有效控制游戏流程。您可以在"),e("RouterLink",{attrs:{to:"/zh/api/"}},[t._v("API参考 ")]),t._v(" 中找到可用的内置命令。在代码中，所有内置脚本命令实现均在 "),e("code",[t._v("Naninovel.Commands")]),t._v(" 命名空间下定义。")],1),t._v(" "),e("p",[t._v("要添加自己的自定义脚本命令，请创建一个C#的新类派生自"),e("code",[t._v("Command")]),t._v(" 并实现ExecuteAsync抽象方法。引擎将自动选择创建的类，能够通过类名或别名（如果已分配）从naninovel脚本调用命令。要将别名分配给naninovel命令，请将"),e("code",[t._v("CommandAlias")]),t._v(" 标签应用于该类。")]),t._v(" "),e("p",[e("code",[t._v("ExecuteAsync")]),t._v(" 是当脚本执行命令时调用的异步方法。使用 "),e("RouterLink",{attrs:{to:"/zh/guide/engine-services.html"}},[t._v("引擎服务")]),t._v(" 访问引擎内置系统。Naninovel脚本将会暂停，直到该执行方法完成返回 "),e("code",[t._v("Wait")]),t._v(" 参数为 "),e("code",[t._v("true")]),t._v("。")],1),t._v(" "),e("p",[t._v("要将命令参数公开给naninovel脚本，请使用一种受支持的类型向命令类添加一个公共字段：")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",[t._v("字段类型")]),t._v(" "),e("th",[t._v("值类型")]),t._v(" "),e("th",[t._v("脚本示例")])])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("StringParameter")]),t._v(" "),e("td",[t._v("String")]),t._v(" "),e("td",[e("code",[t._v("LoremIpsum")]),t._v(", "),e("code",[t._v('"Lorem ipsum"')])])]),t._v(" "),e("tr",[e("td",[t._v("IntegerParameter")]),t._v(" "),e("td",[t._v("Int32")]),t._v(" "),e("td",[e("code",[t._v("10")]),t._v(", "),e("code",[t._v("0")]),t._v(", "),e("code",[t._v("-1")])])]),t._v(" "),e("tr",[e("td",[t._v("DecimalParameter")]),t._v(" "),e("td",[t._v("Single")]),t._v(" "),e("td",[e("code",[t._v("0.525")]),t._v(", "),e("code",[t._v("-55.1")])])]),t._v(" "),e("tr",[e("td",[t._v("BooleanParameter")]),t._v(" "),e("td",[t._v("Boolean")]),t._v(" "),e("td",[e("code",[t._v("true")]),t._v(", "),e("code",[t._v("false")])])]),t._v(" "),e("tr",[e("td",[t._v("NamedStringParameter")]),t._v(" "),e("td",[t._v("NamedString")]),t._v(" "),e("td",[e("code",[t._v("Script001.LabelName")]),t._v(", "),e("code",[t._v(".LabelName")])])]),t._v(" "),e("tr",[e("td",[t._v("NamedIntegerParameter")]),t._v(" "),e("td",[t._v("NamedInteger")]),t._v(" "),e("td",[e("code",[t._v("Yuko.5")])])]),t._v(" "),e("tr",[e("td",[t._v("NamedDecimalParameter")]),t._v(" "),e("td",[t._v("NamedFloat")]),t._v(" "),e("td",[e("code",[t._v("Kohaku.-10.25")])])]),t._v(" "),e("tr",[e("td",[t._v("NamedBooleanParameter")]),t._v(" "),e("td",[t._v("NamedBoolean")]),t._v(" "),e("td",[e("code",[t._v("Misaki.false")])])]),t._v(" "),e("tr",[e("td",[t._v("StringListParameter")]),t._v(" "),e("td",[t._v("List<String>")]),t._v(" "),e("td",[e("code",[t._v('Lorem,ipsum,"doler sit amet"')])])]),t._v(" "),e("tr",[e("td",[t._v("IntegerListParameter")]),t._v(" "),e("td",[t._v("List<Int32>")]),t._v(" "),e("td",[e("code",[t._v("10,-1,0")])])]),t._v(" "),e("tr",[e("td",[t._v("DecimalListParameter")]),t._v(" "),e("td",[t._v("List<Single>")]),t._v(" "),e("td",[e("code",[t._v("0.2,10.5,-88.99")])])]),t._v(" "),e("tr",[e("td",[t._v("BooleanListParameter")]),t._v(" "),e("td",[t._v("List<Boolean>")]),t._v(" "),e("td",[e("code",[t._v("true,false,true")])])]),t._v(" "),e("tr",[e("td",[t._v("NamedStringListParameter")]),t._v(" "),e("td",[t._v("List<NamedString>")]),t._v(" "),e("td",[e("code",[t._v("Felix.Happy,Jenna.Confidence")])])]),t._v(" "),e("tr",[e("td",[t._v("NamedIntegerListParameter")]),t._v(" "),e("td",[t._v("List<NamedInteger>")]),t._v(" "),e("td",[e("code",[t._v("Yuko.5,Misaki.-8")])])]),t._v(" "),e("tr",[e("td",[t._v("NamedDecimalListParameter")]),t._v(" "),e("td",[t._v("List<NamedFloat>")]),t._v(" "),e("td",[e("code",[t._v("Nanikun.88.99,Yuko.-5.1")])])]),t._v(" "),e("tr",[e("td",[t._v("NamedBooleanListParameter")]),t._v(" "),e("td",[t._v("List<NamedBoolean>")]),t._v(" "),e("td",[e("code",[t._v("Misaki.false,Kohaku.true")])])])])]),t._v(" "),e("p",[t._v("另外，您可以将 "),e("code",[t._v("[ParameterAlias]")]),t._v("属性应用于字段，作为参数别名，从而在naninovel脚本中引用参数时可以使用别名而不是字段名称。如果想设置为无名参数，则将 "),e("code",[t._v("Command.NamelessParameterAlias")]),t._v(" 常量（空字符串）设置为别名；请注意，每个命令只允许使用一个无名参数。")]),t._v(" "),e("p",[t._v("要使参数为必需设置的（在naninovel脚本中未指定该参数时会在控制台报错），请将 "),e("code",[t._v("[RequiredParameter]")]),t._v(" 属性应用于该字段。如果不应用该属性，则该参数被视为可选参数。")]),t._v(" "),e("p",[t._v("所有参数类型都有 "),e("code",[t._v("HasValue")]),t._v(" 属性，可以使用它来测试是否已在naninovel脚本中分配了参数；（可选）可以使用 "),e("code",[t._v("Command.Assigned()")]),t._v(" 静态方法，该方法采用参数实例，并在提供的参数不为null并分配了值时返回true。")]),t._v(" "),e("p",[t._v("如果命令的执行需要加载一些资源，实现"),e("code",[t._v("Command.IPreloadable")]),t._v(" 接口，以在游戏加载时时预加载要使用的资源。")]),t._v(" "),e("p",[t._v("如果命令具有可以本地化的参数（通常直接向用户显示文本），请实现 "),e("code",[t._v("Command.ILocalizable")]),t._v(" 接口以将命令添加到生成的脚本本地化文档中。")]),t._v(" "),e("p",[t._v("您可以在 "),e("code",[t._v("Naninovel/Runtime/Commands")]),t._v("文件夹中找到所有内置命令实现的脚本。在实现自己的自定义命令时，可以随时将它们用作参考。")]),t._v(" "),e("p",[t._v("这是一个自定义命令的示例，可以从naninovel脚本调用该命令 "),e("code",[t._v("@HelloWorld")]),t._v(" 或 "),e("code",[t._v("@hello")]),t._v(" 将 "),e("code",[t._v("Hello World!")]),t._v(" 打印到控制台，还可以使用一个可选 "),e("code",[t._v("name")]),t._v(" 参数（例如"),e("code",[t._v("@hello name:Felix")]),t._v("）来提供名称：")]),t._v(" "),e("div",{staticClass:"language-csharp extra-class"},[e("pre",{pre:!0,attrs:{class:"language-csharp"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("using")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("Naninovel"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Commands")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("using")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("System"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Threading")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("using")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("UniRx"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Async")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("using")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("UnityEngine")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token attribute"}},[e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CommandAlias")]),e("span",{pre:!0,attrs:{class:"token attribute-arguments"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"hello"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")])])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HelloWorld")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token type-list"}},[e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Command")])]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("StringParameter")]),t._v(" Name"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("override")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token return-type class-name"}},[t._v("UniTask")]),t._v(" ExecuteAsync "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CancellationToken")]),t._v(" cancellationToken "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Assigned")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Name"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            Debug"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Log")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token interpolation-string"}},[e("span",{pre:!0,attrs:{class:"token string"}},[t._v('$"Hello, ')]),e("span",{pre:!0,attrs:{class:"token interpolation"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),e("span",{pre:!0,attrs:{class:"token expression language-csharp"}},[t._v("Name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('!"')])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            Debug"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Log")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Hello World!"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n        "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" UniTask"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("CompletedTask"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("p",[t._v("注意可选 "),e("code",[t._v("CancellationToken")]),t._v(" 参数。如果调用任何异步方法，请确保检查该值的取消请求，并尽快返回该值。")]),t._v(" "),e("div",{staticClass:"custom-block example"},[e("p",{staticClass:"custom-block-title"},[t._v("例")]),t._v(" "),e("p",[t._v("关于添加自定义命令来在背包中增加删除道具的示例在"),e("a",{attrs:{href:"https://github.com/Naninovel/Inventory",target:"_blank",rel:"noopener noreferrer"}},[t._v("背包示例项目中"),e("OutboundLink")],1),t._v(" 。")]),t._v(" "),e("p",[t._v("另外，命令实现存储在"),e("a",{attrs:{href:"https://github.com/Naninovel/Inventory/tree/master/Assets/NaninovelInventory/Runtime/Commands",target:"_blank",rel:"noopener noreferrer"}},[t._v("Runtime/Commands"),e("OutboundLink")],1),t._v(" 目录中。")])])])}),[],!1,null,null,null);a.default=s.exports}}]);