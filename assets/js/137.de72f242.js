(window.webpackJsonp=window.webpackJsonp||[]).push([[137],{528:function(a,t,s){"use strict";s.r(t);var n=s(42),e=Object(n.a)({},(function(){var a=this,t=a.$createElement,s=a._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"выражения-сценария"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#выражения-сценария"}},[a._v("#")]),a._v(" Выражения сценария")]),a._v(" "),s("p",[a._v("При написании сценариев naninovel можно вводить конструкции выражений в значения параметров команд и общие текстовые строки с помощью фигурных скобок "),s("code",[a._v("{}")]),a._v(":")]),a._v(" "),s("div",{staticClass:"language-nani extra-class"},[s("pre",{pre:!0,attrs:{class:"language-nani"}},[s("code",[s("span",{pre:!0,attrs:{class:"token generic-text punctuation"}},[a._v("One plus two equals "),s("span",{pre:!0,attrs:{class:"token expression selector"}},[a._v("{1 + 2}")]),a._v(".")]),a._v("\n")])])]),s("p",[a._v('— выведет "One plus two equals 3" при исполнении сценария.')]),a._v(" "),s("p",[a._v("Вы можете использовать любые математические и логические операторы, а также все математические функции из пространств имён "),s("a",{attrs:{href:"https://docs.unity3d.com/ScriptReference/Mathf.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("UnityEngine.Mathf"),s("OutboundLink")],1),a._v(" и "),s("a",{attrs:{href:"https://docs.microsoft.com/en-us/dotnet/api/system.math#methods",target:"_blank",rel:"noopener noreferrer"}},[a._v("System.Math"),s("OutboundLink")],1),a._v(":")]),a._v(" "),s("div",{staticClass:"language-nani extra-class"},[s("pre",{pre:!0,attrs:{class:"language-nani"}},[s("code",[s("span",{pre:!0,attrs:{class:"token command function"}},[s("span",{pre:!0,attrs:{class:"token command-name"}},[a._v("@char")]),s("span",{pre:!0,attrs:{class:"token command-params"}},[s("span",{pre:!0,attrs:{class:"token command-param-value operator"}},[a._v(" ")]),s("span",{pre:!0,attrs:{class:"token command-param-value operator"}},[a._v("Kohaku")]),s("span",{pre:!0,attrs:{class:"token command-param-id property"}},[a._v(" scale:")])]),s("span",{pre:!0,attrs:{class:"token expression selector"}},[a._v("{Pow(Cosh(33.5), 3) % Log(0.5)}")])]),a._v("\n")])])]),s("p",[a._v('– будет масштабировать персонажа с ID "Kohaku" со значением от деления гиперболического косинуса угла в 33,5 °, возведённого в третью степень, на натуральный логарифм от 0,5.')]),a._v(" "),s("p",[a._v("Выражение вычисляется в момент выполнения команды, что позволяет использовать "),s("RouterLink",{attrs:{to:"/ru/guide/custom-variables.html"}},[a._v("пользовательские переменные")]),a._v(" внутри выражений:")],1),a._v(" "),s("div",{staticClass:"language-nani extra-class"},[s("pre",{pre:!0,attrs:{class:"language-nani"}},[s("code",[s("span",{pre:!0,attrs:{class:"token command function"}},[s("span",{pre:!0,attrs:{class:"token command-name"}},[a._v("@input")]),s("span",{pre:!0,attrs:{class:"token command-params"}},[s("span",{pre:!0,attrs:{class:"token command-param-value operator"}},[a._v(" ")]),s("span",{pre:!0,attrs:{class:"token command-param-value operator"}},[a._v("color")]),s("span",{pre:!0,attrs:{class:"token command-param-id property"}},[a._v(" summary:")]),s("span",{pre:!0,attrs:{class:"token quoted-string operator"}},[a._v('"What\'s your favorite color?"')])])]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token command function"}},[s("span",{pre:!0,attrs:{class:"token command-name"}},[a._v("@stop")])]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token generic-text punctuation"}},[s("span",{pre:!0,attrs:{class:"token expression selector"}},[a._v("{color}")]),a._v(", huh? "),s("span",{pre:!0,attrs:{class:"token expression selector"}},[a._v('{ color == "orange" ? "Mine too!" : "I see..."}')])]),a._v("\n")])])]),s("p",[a._v("— выведет пользовательский интерфейс ввода, позволяющий игроку ввести свой любимый цвет, назначив его пользовательской переменной "),s("code",[a._v("color")]),a._v(', а затем распечатать введенный цвет, а затем либо "Mine too!" – на случай, если это "orange", или же "I see...".')]),a._v(" "),s("p",[a._v("Чтобы отличить обычное текстовое значение от имени переменной, заключите его в двойные кавычки "),s("code",[a._v('"')]),a._v(":")]),a._v(" "),s("div",{staticClass:"language-nani extra-class"},[s("pre",{pre:!0,attrs:{class:"language-nani"}},[s("code",[s("span",{pre:!0,attrs:{class:"token generic-text punctuation"}},[a._v("This is just a plain text: "),s("span",{pre:!0,attrs:{class:"token expression selector"}},[a._v('{ "score" }')]),a._v(".")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token generic-text punctuation"}},[a._v('And this is the value of "score" variable: '),s("span",{pre:!0,attrs:{class:"token expression selector"}},[a._v("{ score }")]),a._v(".")]),a._v("\n")])])]),s("p",[a._v("Если вы хотите включить двойные кавычки в выражение, экранируйте их "),s("strong",[a._v("дважды")]),a._v(":")]),a._v(" "),s("div",{staticClass:"language-nani extra-class"},[s("pre",{pre:!0,attrs:{class:"language-nani"}},[s("code",[s("span",{pre:!0,attrs:{class:"token generic-text punctuation"}},[a._v("Saying "),s("span",{pre:!0,attrs:{class:"token expression selector"}},[a._v('{ \\\\"Stop the car\\\\" }')]),a._v(" was a mistake.")]),a._v("\n")])])]),s("p",[a._v("Выражения сценария с использованием команд "),s("a",{attrs:{href:"/ru/api/#set",target:"_blank"}},[s("code",[a._v("@set")])]),a._v(" и "),s("a",{attrs:{href:"/ru/api/#if",target:"_blank"}},[s("code",[a._v("@if")])]),a._v(" (а также "),s("code",[a._v("set")]),a._v(" и "),s("code",[a._v("if")]),a._v(" параметры в других командах) не требуют фигурных скобок:")]),a._v(" "),s("div",{staticClass:"language-nani extra-class"},[s("pre",{pre:!0,attrs:{class:"language-nani"}},[s("code",[s("span",{pre:!0,attrs:{class:"token command function"}},[s("span",{pre:!0,attrs:{class:"token command-name"}},[a._v("@set")]),s("span",{pre:!0,attrs:{class:"token command-params"}},[s("span",{pre:!0,attrs:{class:"token command-param-value operator"}},[a._v(" ")]),s("span",{pre:!0,attrs:{class:"token command-param-value operator"}},[a._v("randomScore=Random(-100,100)")])])]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token command function"}},[s("span",{pre:!0,attrs:{class:"token command-name"}},[a._v("@goto")]),s("span",{pre:!0,attrs:{class:"token command-params"}},[s("span",{pre:!0,attrs:{class:"token command-param-value operator"}},[a._v(" ")]),s("span",{pre:!0,attrs:{class:"token command-param-value operator"}},[a._v("EpicLabel")]),s("span",{pre:!0,attrs:{class:"token command-param-id property"}},[a._v(" if:")]),s("span",{pre:!0,attrs:{class:"token command-param-value operator"}},[a._v("Abs(randomScore)>=50")])])]),a._v("\n")])])]),s("p",[a._v("Однако, как и во всех других значениях параметров, если вы хотите использовать пробелы внутри выражений, вам следует заключить их в двойные кавычки:")]),a._v(" "),s("div",{staticClass:"language-nani extra-class"},[s("pre",{pre:!0,attrs:{class:"language-nani"}},[s("code",[s("span",{pre:!0,attrs:{class:"token command function"}},[s("span",{pre:!0,attrs:{class:"token command-name"}},[a._v("@set")]),s("span",{pre:!0,attrs:{class:"token command-params"}},[s("span",{pre:!0,attrs:{class:"token command-param-value operator"}},[a._v(" ")]),s("span",{pre:!0,attrs:{class:"token quoted-string operator"}},[a._v('"randomScore = Random(-100, 100)"')])])]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token command function"}},[s("span",{pre:!0,attrs:{class:"token command-name"}},[a._v("@goto")]),s("span",{pre:!0,attrs:{class:"token command-params"}},[s("span",{pre:!0,attrs:{class:"token command-param-value operator"}},[a._v(" ")]),s("span",{pre:!0,attrs:{class:"token command-param-value operator"}},[a._v("EpicLabel")]),s("span",{pre:!0,attrs:{class:"token command-param-id property"}},[a._v(" if:")]),s("span",{pre:!0,attrs:{class:"token quoted-string operator"}},[a._v('"Abs(randomScore) >= 50"')])])]),a._v("\n")])])]),s("p",[a._v("Чтобы напечатать фигурные скобки внутри общей текстовой строки и предотвратить их распознавание как начальных и конечных литералов выражения, экранируйте фигурные скобки с помощью обратной косой черты, например:")]),a._v(" "),s("div",{staticClass:"language-nani extra-class"},[s("pre",{pre:!0,attrs:{class:"language-nani"}},[s("code",[s("span",{pre:!0,attrs:{class:"token generic-text punctuation"}},[a._v("Some text "),s("span",{pre:!0,attrs:{class:"token escaped-char"}},[a._v("\\{")]),a._v(" text inside braces "),s("span",{pre:!0,attrs:{class:"token escaped-char"}},[a._v("\\}")])]),a._v("\n")])])]),s("p",[a._v('— напечатает "Some text { text inside braces }" в игре.')]),a._v(" "),s("h2",{attrs:{id:"функции-выражений"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#функции-выражений"}},[a._v("#")]),a._v(" Функции выражений")]),a._v(" "),s("p",[a._v("Внутри выражений сценария также можно использовать следующие функции.")]),a._v(" "),s("div",{staticClass:"config-table"},[s("table",[s("thead",[s("tr",[s("th",[a._v("Сигнатура?")]),a._v(" "),s("th",[a._v("Описание")]),a._v(" "),s("th",[a._v("Пример")])])]),a._v(" "),s("tbody",[s("tr",[s("td",[a._v("Random ("),s("em",[a._v("System.Double")]),a._v(" min, "),s("em",[a._v("System.Double")]),a._v(" max)")]),a._v(" "),s("td",[a._v("Возвращает случайное число с плавающей точкой между минимальным [включительно] и максимальным [включительно] значениями.")]),a._v(" "),s("td",[s("code",[a._v("Random(0.1, 0.85)")])])]),a._v(" "),s("tr",[s("td",[a._v("Random ("),s("em",[a._v("System.Int32")]),a._v(" min, "),s("em",[a._v("System.Int32")]),a._v(" max)")]),a._v(" "),s("td",[a._v("Возвращает случайное целое число между минимальным [включительно] и максимальным [включительно] значениями.")]),a._v(" "),s("td",[s("code",[a._v("Random(0, 100)")])])]),a._v(" "),s("tr",[s("td",[a._v("Random ("),s("em",[a._v("System.String[]")]),a._v(" args)")]),a._v(" "),s("td",[a._v("Возвращает одну случайную из предоставленных строк.")]),a._v(" "),s("td",[s("code",[a._v('Random("Foo", "Bar", "Foobar")')])])]),a._v(" "),s("tr",[s("td",[a._v("CalculateProgress ()")]),a._v(" "),s("td",[a._v("Возвращает число с плавающей точкой в диапазоне от 0.0 до 1.0, представляющее, сколько уникальных команд было когда-либо выполнено по сравнению с общим числом команд во всех доступных скриптах Naninovel. 1.0 означает, что игрок "),s("code",[a._v("прочитал")]),a._v(" или "),s("code",[a._v("увидел")]),a._v(" весь доступный игровой контент. Перед использованием этой функции убедитесь, что в меню конфигурации скрипта включена функция "),s("code",[a._v("Count Total Commands")]),a._v(".")]),a._v(" "),s("td",[s("code",[a._v("CalculateProgress()")])])])])])]),a._v(" "),s("h2",{attrs:{id:"добавnение-поnьзоватеnьских-функций"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#добавnение-поnьзоватеnьских-функций"}},[a._v("#")]),a._v(" Добавление пользовательских функций")]),a._v(" "),s("p",[a._v("Можно добавить пользовательские функции выражений, присваивая атрибут "),s("code",[a._v("ExpressionFunctions")]),a._v(" статическому классу C#. Все открытые методы этого класса с совместимыми сигнатурами будут автоматически доступны в выражениях сценария.")]),a._v(" "),s("p",[a._v("Совместимые подписи – это те, которые принимают и возвращают "),s("a",{attrs:{href:"https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/keywords/value-types#simple-types",target:"_blank",rel:"noopener noreferrer"}},[a._v("простые"),s("OutboundLink")],1),a._v(" и строковые типы, а также массивы этих типов (с ключевым словом "),s("code",[a._v("params")]),a._v(").")]),a._v(" "),s("div",{staticClass:"language-csharp extra-class"},[s("pre",{pre:!0,attrs:{class:"language-csharp"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token attribute"}},[s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Naninovel"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("ExpressionFunctions")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("static")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("CustomFunctions")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n\t"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// Возвращает предоставленную строку, конвертировав все её символы в нижний регистр.")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("static")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token return-type class-name"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("string")])]),a._v(" ToLower "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("string")])]),a._v(" content"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=>")]),a._v(" content"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("ToLower")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// Возвращает сумму предоставленных чисел.")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("static")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token return-type class-name"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")])]),a._v(" Add "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")])]),a._v(" a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")])]),a._v(" b"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=>")]),a._v(" a "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+")]),a._v(" b"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// Возвращает одну случайную из предоставленных строк.")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("static")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token return-type class-name"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("string")])]),a._v(" Random "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("params")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("string")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")])]),a._v(" args"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" \n\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("args "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("==")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("null")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("||")]),a._v(" args"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("Length "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("==")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" \n\t\t\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("default")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        \n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("var")])]),a._v(" randomIndex "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" UnityEngine"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("Random"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("Range")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" args"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("Length"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v(" args"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("randomIndex"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v(" \n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),s("div",{staticClass:"custom-block example"},[s("p",{staticClass:"custom-block-title"},[a._v("ПРИМЕР")]),a._v(" "),s("p",[a._v("Другой пример добавления пользовательских функций выражений для проверки наличия элемента в инвентаре можно найти в проекте "),s("a",{attrs:{href:"https://github.com/Naninovel/Inventory",target:"_blank",rel:"noopener noreferrer"}},[a._v("пример инвентаря на GitHub"),s("OutboundLink")],1),a._v(".")]),a._v(" "),s("p",[a._v("В частности, пользовательские функции реализуются через сценарий выполнения "),s("a",{attrs:{href:"https://github.com/Naninovel/Inventory/blob/master/Assets/NaninovelInventory/Runtime/InventoryFunctions.cs",target:"_blank",rel:"noopener noreferrer"}},[a._v("Inventory Functions.cs"),s("OutboundLink")],1),a._v(".")])])])}),[],!1,null,null,null);t.default=e.exports}}]);