(window.webpackJsonp=window.webpackJsonp||[]).push([[116],{400:function(t,a,e){"use strict";e.r(a);var n=e(42),s=Object(n.a)({},(function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"поnьзоватеnьские-команды"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#поnьзоватеnьские-команды"}},[t._v("#")]),t._v(" Пользовательские команды")]),t._v(" "),e("p",[t._v("Команда представляет собой единую операцию, которая управляет тем, что происходит в сцене; например, она может быть использована для изменения фона, перемещения персонажа или загрузки другого сценария Naninovel. Параметризованные последовательности команд, определенные в "),e("RouterLink",{attrs:{to:"/ru/guide/naninovel-scripts.html"}},[t._v("сценариях Naninovel")]),t._v(", эффективно управляют игровым потоком. Доступные встроенные команды можно найти в "),e("RouterLink",{attrs:{to:"/ru/api/"}},[t._v("справочнике API")]),t._v(". В коде все встроенные реализации команд сценария определяются в разделе "),e("code",[t._v("Naninovel.Commands")]),t._v(".")],1),t._v(" "),e("p",[t._v("Чтобы добавить свою собственную команду сценария, создайте новый производный от "),e("code",[t._v("Command")]),t._v(" класс C# и реализуйте абстрактный метод "),e("code",[t._v("ExecuteAsync")]),t._v(". Созданный класс будет автоматически определён движком, и вы сможете вызвать команду из сценариев Naninovel либо по имени класса, либо по псевдониму (если он назначен). Чтобы назначить псевдоним команде Naninovel, примените атрибут "),e("code",[t._v("CommandAlias")]),t._v(" к классу.")]),t._v(" "),e("p",[e("code",[t._v("ExecuteAsync")]),t._v(" – это асинхронный метод, вызываемый при выполнении команды проигрывателем сценариев; поместите туда логику команды. Используйте "),e("RouterLink",{attrs:{to:"/ru/guide/engine-services.html"}},[t._v("сервисы движка")]),t._v(" для доступа к встроенным системам движка. Выполнение сценария Naninovel остановится до тех пор, пока этот метод не вернет завершенную задачу, если параметр "),e("code",[t._v("Wait")]),t._v(" имеет значение "),e("code",[t._v("true")]),t._v(".")],1),t._v(" "),e("p",[t._v("Чтобы предоставить параметр команды сценариям Naninovel, добавьте в класс команд публичное поле с одним из поддерживаемых типов:")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",[t._v("Тип поля")]),t._v(" "),e("th",[t._v("Тип значения")]),t._v(" "),e("th",[t._v("Пример скрипта")])])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("StringParameter")]),t._v(" "),e("td",[t._v("String")]),t._v(" "),e("td",[e("code",[t._v("LoremIpsum")]),t._v(", "),e("code",[t._v('"Lorem ipsum"')])])]),t._v(" "),e("tr",[e("td",[t._v("IntegerParameter")]),t._v(" "),e("td",[t._v("Int32")]),t._v(" "),e("td",[e("code",[t._v("10")]),t._v(", "),e("code",[t._v("0")]),t._v(", "),e("code",[t._v("-1")])])]),t._v(" "),e("tr",[e("td",[t._v("DecimalParameter")]),t._v(" "),e("td",[t._v("Single")]),t._v(" "),e("td",[e("code",[t._v("0.525")]),t._v(", "),e("code",[t._v("-55.1")])])]),t._v(" "),e("tr",[e("td",[t._v("BooleanParameter")]),t._v(" "),e("td",[t._v("Boolean")]),t._v(" "),e("td",[e("code",[t._v("true")]),t._v(", "),e("code",[t._v("false")])])]),t._v(" "),e("tr",[e("td",[t._v("NamedStringParameter")]),t._v(" "),e("td",[t._v("NamedString")]),t._v(" "),e("td",[e("code",[t._v("Script001.LabelName")]),t._v(", "),e("code",[t._v(".LabelName")])])]),t._v(" "),e("tr",[e("td",[t._v("NamedIntegerParameter")]),t._v(" "),e("td",[t._v("NamedInteger")]),t._v(" "),e("td",[e("code",[t._v("Yuko.5")])])]),t._v(" "),e("tr",[e("td",[t._v("NamedDecimalParameter")]),t._v(" "),e("td",[t._v("NamedFloat")]),t._v(" "),e("td",[e("code",[t._v("Kohaku.-10.25")])])]),t._v(" "),e("tr",[e("td",[t._v("NamedBooleanParameter")]),t._v(" "),e("td",[t._v("NamedBoolean")]),t._v(" "),e("td",[e("code",[t._v("Misaki.false")])])]),t._v(" "),e("tr",[e("td",[t._v("StringListParameter")]),t._v(" "),e("td",[t._v("List<String>")]),t._v(" "),e("td",[e("code",[t._v('Lorem,ipsum,"doler sit amet"')])])]),t._v(" "),e("tr",[e("td",[t._v("IntegerListParameter")]),t._v(" "),e("td",[t._v("List<Int32>")]),t._v(" "),e("td",[e("code",[t._v("10,-1,0")])])]),t._v(" "),e("tr",[e("td",[t._v("DecimalListParameter")]),t._v(" "),e("td",[t._v("List<Single>")]),t._v(" "),e("td",[e("code",[t._v("0.2,10.5,-88.99")])])]),t._v(" "),e("tr",[e("td",[t._v("BooleanListParameter")]),t._v(" "),e("td",[t._v("List<Boolean>")]),t._v(" "),e("td",[e("code",[t._v("true,false,true")])])]),t._v(" "),e("tr",[e("td",[t._v("NamedStringListParameter")]),t._v(" "),e("td",[t._v("List<NamedString>")]),t._v(" "),e("td",[e("code",[t._v("Felix.Happy,Jenna.Confidence")])])]),t._v(" "),e("tr",[e("td",[t._v("NamedIntegerListParameter")]),t._v(" "),e("td",[t._v("List<NamedInteger>")]),t._v(" "),e("td",[e("code",[t._v("Yuko.5,Misaki.-8")])])]),t._v(" "),e("tr",[e("td",[t._v("NamedDecimalListParameter")]),t._v(" "),e("td",[t._v("List<NamedFloat>")]),t._v(" "),e("td",[e("code",[t._v("Nanikun.88.99,Yuko.-5.1")])])]),t._v(" "),e("tr",[e("td",[t._v("NamedBooleanListParameter")]),t._v(" "),e("td",[t._v("List<NamedBoolean>")]),t._v(" "),e("td",[e("code",[t._v("Misaki.false,Kohaku.true")])])])])]),t._v(" "),e("p",[t._v("При необходимости можно применить атрибут "),e("code",[t._v("[ParameterAlias]")]),t._v(" к полю, чтобы присвоить параметру псевдоним, позволяющий использовать его вместо имени поля при ссылке на параметр в сценариях Naninovel. Если вы хотите сделать параметр безымянным, установите константу "),e("code",[t._v("Command.NamelessParameterAlias")]),t._v(" (пустая строка) в качестве псевдонима; обратите внимание, что для каждой команды разрешен только один безымянный параметр.")]),t._v(" "),e("p",[t._v("Чтобы сделать параметр обязательным (вызывающим регистрацию ошибки, если он не был определён в сценарии Naninovel), примените к полю атрибут "),e("code",[t._v("[RequiredParameter]")]),t._v(". Если атрибут не применяется, параметр считается необязательным.")]),t._v(" "),e("p",[t._v("Все типы параметров имеют свойство "),e("code",[t._v("HasValue")]),t._v(", которое можно использовать для проверки того, был ли параметр назначен в сценарии Naninovel; дополнительно можно использовать статичный метод "),e("code",[t._v("Command.Assigned()")]),t._v(', который принимает экземпляр параметра и возвращает "true", когда данный параметр не является нулевым и имеет назначенное значение.')]),t._v(" "),e("p",[t._v("В случае, если выполнение команды требует загрузки некоторых ресурсов, включите интерфейс "),e("code",[t._v("Command.IPreloadable")]),t._v(" для предварительной загрузки необходимых ресурсов при загрузке игры.")]),t._v(" "),e("p",[t._v("В случае, если команда имеет параметры, которые могут быть локализованы (обычно текст, непосредственно представленный пользователю), реализуйте интерфейс "),e("code",[t._v("Command.ILocalizable")]),t._v(" для добавления команды в сгенерированные документы локализации сценария.")]),t._v(" "),e("p",[t._v("Вы можете найти сценарии со всеми встроенными реализациями команд в папке пакета "),e("code",[t._v("Naninovel/Runtime/Commands")]),t._v("; можно использовать их в качестве примера при реализации ваших собственных пользовательских команд.")]),t._v(" "),e("p",[t._v("Вот пример пользовательской команды, которая может быть вызвана из сценариев Naninovel как "),e("code",[t._v("@HelloWorld")]),t._v(" или "),e("code",[t._v("@hello")]),t._v(" для печати "),e("code",[t._v("Hello World!")]),t._v(" в консоли, а также может принять дополнительный параметр "),e("code",[t._v("name")]),t._v(" (например, "),e("code",[t._v("@hello name:Felix")]),t._v("), чтобы приветствовать предоставленное имя вместо мира:")]),t._v(" "),e("div",{staticClass:"language-csharp extra-class"},[e("pre",{pre:!0,attrs:{class:"language-csharp"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("using")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("Naninovel"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Commands")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("using")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("System"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Threading")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("using")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("UniRx"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Async")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("using")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("UnityEngine")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token attribute"}},[e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CommandAlias")]),e("span",{pre:!0,attrs:{class:"token attribute-arguments"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"hello"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")])])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HelloWorld")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token type-list"}},[e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Command")])]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("StringParameter")]),t._v(" Name"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("override")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token return-type class-name"}},[t._v("UniTask")]),t._v(" ExecuteAsync "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CancellationToken")]),t._v(" cancellationToken "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Assigned")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Name"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            Debug"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Log")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token interpolation-string"}},[e("span",{pre:!0,attrs:{class:"token string"}},[t._v('$"Hello, ')]),e("span",{pre:!0,attrs:{class:"token interpolation"}},[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),e("span",{pre:!0,attrs:{class:"token expression language-csharp"}},[t._v("Name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('!"')])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            Debug"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Log")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Hello World!"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n        "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" UniTask"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("CompletedTask"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("p",[t._v("Обратите внимание на необязательный аргумент "),e("code",[t._v("CancellationToken")]),t._v(". В случае вызова каких-либо асинхронных методов обязательно проверьте токен на наличие запросов на отмену и возврат как можно скорее.")]),t._v(" "),e("div",{staticClass:"custom-block example"},[e("p",{staticClass:"custom-block-title"},[t._v("ПРИМЕР")]),t._v(" "),e("p",[t._v("Другой пример добавления пользовательских команд для добавления/удаления элементов системы инвентаря можно найти в "),e("a",{attrs:{href:"https://github.com/Naninovel/Inventory",target:"_blank",rel:"noopener noreferrer"}},[t._v("примере проекта инвентаря на GitHub"),e("OutboundLink")],1),t._v(".")]),t._v(" "),e("p",[t._v("В частности, реализации команд хранятся в директории "),e("a",{attrs:{href:"https://github.com/Naninovel/Inventory/tree/master/Assets/NaninovelInventory/Runtime/Commands",target:"_blank",rel:"noopener noreferrer"}},[t._v("Runtime/Commands"),e("OutboundLink")],1),t._v(".")])])])}),[],!1,null,null,null);a.default=s.exports}}]);